let marvelCharactersMale = [
  {
    name: "Captain America",
    imgUrl: "/male/captain-america.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Iron Man",
    imgUrl: "/male/iron-man.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Thor Odinson",
    imgUrl: "/male/thor.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "SuperMan",
    imgUrl: "/male/super-man.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "BatMan",
    imgUrl: "/male/batman.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Doctor Strange",
    imgUrl: "/male/doctor-strange.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
];

let marvelCharactersFemale = [
  {
    name: "Captain Marvel",
    imgUrl: "/female/captain-marvel.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Hela",
    imgUrl: "/female/hela.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Wanda",
    imgUrl: "/female/wanda.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Black Widow",
    imgUrl: "/female/black-widow.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Super Girl",
    imgUrl: "/female/super-girl.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
  {
    name: "Wonder Woman",
    imgUrl: "/female/wonder-woman.jpg",
    about:
      "Lorem ipsum dolor sit amet consectetur adipisicing elit. Quasi rerum, perspiciatis animi distinctio earum maxime laudantium quibusdam saepe quaerat! Veritatis quae blanditiis fugit nobis praesentium in natus magni nesciunt voluptate, pariatur assumenda asperiores quas nihil quasi? Temporibus sequi, id doloremque nesciunt architecto dolorem, minima exercitationem odio placeat quam magni quo debitis voluptate maxime libero rem non maiores iure ratione animi nisi ab.",
  },
];

const app = require("express").Router();
const UserDetails = require("../model/UserDetails");

let getEmail;

app.post("/", async (req, res) => {
  const { email, password } = req.body;
  const userLogin = await UserDetails.find({ email: email });
  if (email.length && password.length) {
    // sending this email to forgetpassword
    getEmail = email;
    // console.log(getEmail);
    // sending done
    if (userLogin.length) {
      if (password == userLogin[0].password1) {
        let userName;
        let about;
        let imgUrl;
        if (userLogin[0].gender == "Male") {
          let indexnumber = Math.floor(
            Math.random() * marvelCharactersMale.length
          );
          userName = marvelCharactersMale[indexnumber].name;
          about = marvelCharactersMale[indexnumber].about;
          imgUrl = marvelCharactersMale[indexnumber].imgUrl;
        } else if (userLogin[0].gender == "Female") {
          let indexnumber = Math.floor(
            Math.random() * marvelCharactersFemale.length
          );
          userName = marvelCharactersFemale[indexnumber].name;
          about = marvelCharactersFemale[indexnumber].about;
          imgUrl = marvelCharactersFemale[indexnumber].imgUrl;
        }
        res.render("profile", {
          name: userLogin[0].fullName,
          bio: userLogin[0].bio,
          userName: userName,
          about: about,
          imgUrl: imgUrl,
        });
      } else {
        res.render("login", {
          incorrectLogin: true,
        });
      }
    } else {
      res.render("login", {
        notRegistered: true,
      });
    }
  }
});

const forgotPass = (mail, password) => {
  const nodeMailer = require("nodemailer");
  const transporter = nodeMailer.createTransport({
    service: "gmail",
    auth: {
      user: "progsake@gmail.com",
      pass: "ChatApp@progsake",
    },
  });
  const composeMail = {
    from: "progsake@gmail.com",
    to: mail,
    subject: "Forgot your password?",
    text:
      "We heard you forgot your ProgSake password. Well, how irresponsible of you.\nPlease find your password below:\n\nYour password is " +
      password,
  };
  transporter.sendMail(composeMail, (err, info) => {
    if (err) console.log(err);
    else console.log("Forgot Password mail sent");
  });
};
app.get("/forgetpassword", async (req, res) => {
  const userDetails = await UserDetails.find({ email: getEmail });
  const password = userDetails[0].password1;
  forgotPass(getEmail, password);
  res.status(200).redirect("../login");
});
module.exports = app;
